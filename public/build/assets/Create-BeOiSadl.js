import{x as se,e as L,f as c,g as w,o as n,h as C,k as V,a as o,d as oe,c as r,i,w as f,u as d,F as v,r as g,t as a,v as k,b as le,n as A,l as S,Q as b}from"./app-GWiVPcSK.js";import{A as ne}from"./AuthenticatedLayout-DehU7O92.js";import{P as re}from"./PageLayout-D8VB3F2Z.js";import{_ as N}from"./SecondaryButton-VohPH0nm.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as ie,e as T}from"./icons-DOtjRcix.js";import"./useAuth-BVqEpHic.js";import"./PageHeader-C174pY8J.js";import"./Icon-BGUd75Np.js";import"./UsersIcon-BpkVLzNK.js";const de={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ce={class:"p-6 text-gray-900"},ue={class:"space-y-4"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe=["value"],ye={key:0,class:"p-3 bg-teal-50 border border-teal-200 rounded-lg"},_e={class:"flex items-center justify-between text-sm"},fe={class:"font-medium text-teal-900"},ve={class:"text-teal-700"},ge={class:"space-y-4"},be={class:"flex items-center justify-between"},xe={key:0,class:"text-sm text-teal-600 font-medium"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"relative"},Ce=["value"],ke={key:0,class:"flex items-center justify-between text-sm"},Ae=["disabled"],Se={key:1,class:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg"},Ee=["onClick"],je={class:"flex items-center space-x-3 flex-1"},De={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-medium text-xs flex-shrink-0"},Be={class:"flex-1 min-w-0"},Ie={class:"text-sm font-medium text-gray-900 truncate"},Le={class:"text-xs text-gray-500 truncate"},Ve={key:0},$e={class:"flex-shrink-0"},Ue={class:"space-y-4"},Pe={class:"flex items-center justify-between"},Me={key:0,class:"text-sm text-teal-600 font-medium"},Ne=["value"],Te={key:0,class:"flex items-center justify-between text-sm"},Fe=["disabled"],ze={key:1,class:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg"},Oe=["onClick"],qe={class:"flex-1 min-w-0 pr-3"},He={class:"text-sm font-medium text-gray-900"},Qe={class:"text-xs text-gray-600 mt-1 line-clamp-2"},Re={class:"flex-shrink-0"},Ge={class:"flex items-center justify-between pt-6 border-t border-gray-200"},Je={class:"flex items-center space-x-3"},Ke=["disabled"],We={key:0,class:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xe={__name:"Create",props:{employees:{type:Array,required:!0},competencies:{type:Array,required:!0},assessmentCycles:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},setup(E){const p=E,t=se({employee_ids:[],competency_ids:[],assessment_type:"manager",assessment_cycle_id:null}),_=L(""),x=L(""),y=L(""),F=c(()=>{let l=p.employees;if(x.value&&(l=l.filter(e=>e.department&&e.department.id===x.value)),_.value&&_.value.length>=2){const e=_.value.toLowerCase();l=l.filter(s=>s.name.toLowerCase().includes(e)||s.position&&s.position.toLowerCase().includes(e))}return l.sort((e,s)=>e.name.localeCompare(s.name))}),u=c(()=>F.value),j=c(()=>p.employees.filter(l=>t.employee_ids.includes(l.id))),z=c(()=>[...new Set(p.competencies.map(e=>e.category))].sort()),m=c(()=>y.value?p.competencies.filter(l=>l.category===y.value).sort((l,e)=>l.name.localeCompare(e.name)):[]),D=c(()=>p.competencies.filter(l=>t.competency_ids.includes(l.id))),h=c(()=>t.assessment_cycle_id?p.assessmentCycles.find(l=>l.id===t.assessment_cycle_id):null),O=c(()=>u.value.length===0?!1:u.value.every(l=>t.employee_ids.includes(l.id))),q=c(()=>m.value.length===0?!1:m.value.every(l=>t.competency_ids.includes(l.id))),$=c(()=>t.employee_ids.length>0&&t.competency_ids.length>0&&!t.processing),B=c(()=>t.employee_ids.length*t.competency_ids.length),H=c(()=>[{label:"Dashboard",href:route("dashboard")},{label:"Assessment Dashboard",href:route("assessment-dashboard")},{label:"Create Assessment",current:!0}]),Q=c(()=>[{label:"Back to Dashboard",href:route("assessment-dashboard"),variant:"secondary",icon:"ArrowLeftIcon"}]),R=l=>l.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2),U=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not set",G=l=>{t.employee_ids.indexOf(l.id)>-1?t.employee_ids=t.employee_ids.filter(s=>s!==l.id):t.employee_ids=[...t.employee_ids,l.id]},J=l=>{t.competency_ids.indexOf(l.id)>-1?t.competency_ids=t.competency_ids.filter(s=>s!==l.id):t.competency_ids=[...t.competency_ids,l.id]},K=()=>{t.employee_ids=[]},W=()=>{t.competency_ids=[]},X=()=>{const e=u.value.map(s=>s.id).filter(s=>!t.employee_ids.includes(s));t.employee_ids=[...t.employee_ids,...e]},Y=()=>{const e=m.value.map(s=>s.id).filter(s=>!t.competency_ids.includes(s));t.competency_ids=[...t.competency_ids,...e]},P=async()=>{if(t.employee_ids.length===0||t.competency_ids.length===0){alert("Please select at least one employee and one competency");return}if(t.employee_ids.length*t.competency_ids.length===1){const e=new URLSearchParams({employee_id:t.employee_ids[0],competency_id:t.competency_ids[0],assessment_type:t.assessment_type});t.assessment_cycle_id&&e.append("assessment_cycle_id",t.assessment_cycle_id);const s=`${route("assessment-form")}?${e.toString()}`;b.visit(s)}else{t.processing=!0;try{let e=0;for(const s of t.competency_ids)await new Promise((I,te)=>{b.post(route("competency-assessments.bulk-create"),{employee_ids:t.employee_ids,competency_id:s,assessment_type:t.assessment_type,assessment_cycle_id:t.assessment_cycle_id},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{e++,I()},onError:M=>{console.error("Bulk create error:",M),te(new Error(Object.values(M).flat().join(", ")))}})});t.processing=!1,b.visit(route("competency-assessments.index"))}catch(e){console.error("Error creating bulk assessments:",e),t.processing=!1,alert(`Failed to create assessments: ${e.message}`)}}},Z=()=>{if(t.employee_ids.length===0||t.competency_ids.length===0){alert("Please select at least one employee and one competency");return}const l=new URLSearchParams({employee_id:t.employee_ids[0],competency_id:t.competency_ids[0],assessment_type:t.assessment_type});t.assessment_cycle_id&&l.append("assessment_cycle_id",t.assessment_cycle_id);const e=`${route("assessment-form")}?${l.toString()}`;b.visit(e)},ee=()=>{b.visit(route("assessment-dashboard"))};return(l,e)=>(n(),w(ne,null,{default:C(()=>[V(re,{title:"Create Assessment",subtitle:"Set up assessment context, select employees and competencies to evaluate",breadcrumbs:H.value,actions:Q.value},{default:C(()=>[e[17]||(e[17]=o("div",{class:"bg-teal-50 border border-teal-200 rounded-lg p-4 mb-6"},[o("div",{class:"flex items-center space-x-2"},[o("div",{class:"w-6 h-6 bg-teal-600 text-white rounded-full flex items-center justify-center text-xs font-medium"}," 1 "),o("div",null,[o("p",{class:"text-sm font-medium text-teal-900"},"Setup Assessment"),o("p",{class:"text-xs text-teal-700"},"Configure context, select participants, and create assessments")])])],-1)),o("div",de,[o("div",ce,[o("form",{onSubmit:oe(P,["prevent"]),class:"space-y-8"},[o("div",ue,[e[9]||(e[9]=o("h3",{class:"text-lg font-semibold text-gray-900"},"Assessment Context",-1)),o("div",me,[o("div",null,[e[6]||(e[6]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Assessment Cycle",-1)),f(o("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>d(t).assessment_cycle_id=s),class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"},[e[5]||(e[5]=o("option",{value:""},"No specific cycle",-1)),(n(!0),r(v,null,g(E.assessmentCycles,s=>(n(),r("option",{key:s.id,value:s.id},a(s.name),9,pe))),128))],512),[[k,d(t).assessment_cycle_id]])]),o("div",null,[e[8]||(e[8]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Assessment Type",-1)),f(o("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>d(t).assessment_type=s),class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"},e[7]||(e[7]=[o("option",{value:"manager"},"Manager Assessment",-1),o("option",{value:"self"},"Self Assessment",-1),o("option",{value:"peer"},"Peer Assessment",-1),o("option",{value:"360"},"360° Feedback",-1)]),512),[[k,d(t).assessment_type]])])]),h.value?(n(),r("div",ye,[o("div",_e,[o("span",fe,a(h.value.name),1),o("span",ve,a(U(h.value.start_date))+" - "+a(U(h.value.end_date)),1)])])):i("",!0)]),o("div",ge,[o("div",be,[e[10]||(e[10]=o("h3",{class:"text-lg font-semibold text-gray-900"},"Select Employees",-1)),j.value.length>0?(n(),r("div",xe,a(j.value.length)+" selected ",1)):i("",!0)]),o("div",he,[o("div",we,[f(o("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),type:"text",placeholder:"Search employees...",class:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"},null,512),[[le,_.value]]),V(d(ie),{class:"absolute left-3 top-3 h-4 w-4 text-gray-400"})]),f(o("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>x.value=s),class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 bg-white"},[e[11]||(e[11]=o("option",{value:""},"All Departments",-1)),(n(!0),r(v,null,g(E.departments,s=>(n(),r("option",{key:s.id,value:s.id},a(s.name),9,Ce))),128))],512),[[k,x.value]])]),u.value.length>0?(n(),r("div",ke,[o("button",{type:"button",onClick:X,class:"text-teal-600 hover:text-teal-800 font-medium",disabled:O.value}," Select All ("+a(u.value.length)+") ",9,Ae),j.value.length>0?(n(),r("button",{key:0,type:"button",onClick:K,class:"text-teal-600 hover:text-teal-800 font-medium"}," Clear All ")):i("",!0)])):i("",!0),u.value.length>0?(n(),r("div",Se,[(n(!0),r(v,null,g(u.value,s=>(n(),r("div",{key:s.id,class:A(["flex items-center p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 cursor-pointer transition-colors",{"bg-teal-50 border-teal-200":d(t).employee_ids.includes(s.id)}]),onClick:I=>G(s)},[o("div",je,[o("div",De,a(R(s.name)),1),o("div",Be,[o("p",Ie,a(s.name),1),o("p",Le,[S(a(s.position||"Employee")+" ",1),s.department?(n(),r("span",Ve," • "+a(s.department.name),1)):i("",!0)])])]),o("div",$e,[o("div",{class:A(["w-4 h-4 rounded border-2 flex items-center justify-center",d(t).employee_ids.includes(s.id)?"bg-teal-600 border-teal-600":"border-gray-300"])},[d(t).employee_ids.includes(s.id)?(n(),w(d(T),{key:0,class:"w-3 h-3 text-white"})):i("",!0)],2)])],10,Ee))),128))])):i("",!0)]),o("div",Ue,[o("div",Pe,[e[12]||(e[12]=o("h3",{class:"text-lg font-semibold text-gray-900"},"Select Competencies",-1)),D.value.length>0?(n(),r("div",Me,a(D.value.length)+" selected ",1)):i("",!0)]),o("div",null,[f(o("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>y.value=s),class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 bg-white"},[e[13]||(e[13]=o("option",{value:""},"Choose a competency category...",-1)),(n(!0),r(v,null,g(z.value,s=>(n(),r("option",{key:s,value:s},a(s),9,Ne))),128))],512),[[k,y.value]])]),y.value&&m.value.length>0?(n(),r("div",Te,[o("button",{type:"button",onClick:Y,class:"text-teal-600 hover:text-teal-800 font-medium",disabled:q.value}," Select All ("+a(m.value.length)+") ",9,Fe),D.value.length>0?(n(),r("button",{key:0,type:"button",onClick:W,class:"text-teal-600 hover:text-teal-800 font-medium"}," Clear All ")):i("",!0)])):i("",!0),y.value&&m.value.length>0?(n(),r("div",ze,[(n(!0),r(v,null,g(m.value,s=>(n(),r("div",{key:s.id,class:A(["flex items-start p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 cursor-pointer transition-colors",{"bg-teal-50 border-teal-200":d(t).competency_ids.includes(s.id)}]),onClick:I=>J(s)},[o("div",qe,[o("p",He,a(s.name),1),o("p",Qe,a(s.description),1)]),o("div",Re,[o("div",{class:A(["w-4 h-4 rounded border-2 flex items-center justify-center",d(t).competency_ids.includes(s.id)?"bg-teal-600 border-teal-600":"border-gray-300"])},[d(t).competency_ids.includes(s.id)?(n(),w(d(T),{key:0,class:"w-3 h-3 text-white"})):i("",!0)],2)])],10,Oe))),128))])):i("",!0)]),o("div",Ge,[o("div",Je,[V(N,{onClick:ee,type:"button"},{default:C(()=>e[14]||(e[14]=[S(" Cancel ")])),_:1,__:[14]}),$.value&&B.value===1?(n(),w(N,{key:0,onClick:Z,type:"button",class:"bg-teal-50 text-teal-700 border-teal-200 hover:bg-teal-100"},{default:C(()=>e[15]||(e[15]=[o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),S(" Add Assessment ")])),_:1,__:[15]})):i("",!0)]),o("button",{type:"button",disabled:!$.value,onClick:P,class:"inline-flex items-center px-6 py-3 bg-teal-500 text-white text-sm font-medium rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[d(t).processing?(n(),r("svg",We,e[16]||(e[16]=[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):i("",!0),S(" "+a(B.value>1?`Create ${B.value} Assessments`:"Create & Complete Assessment"),1)],8,Ke)])],32)])])]),_:1,__:[17]},8,["breadcrumbs","actions"])]),_:1}))}},it=ae(Xe,[["__scopeId","data-v-1d7c25cb"]]);export{it as default};
