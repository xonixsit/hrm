import{c as l,o as a,a as t,e as b,f as K,A as X,g as Y,h as j,k as c,Q as Z,i,l as v,u as y,t as d,q as ee,n as te,d as N,F as w,r as k,w as f,v as _,j as C,H as P}from"./app-MVT20SDE.js";import{a as se,r as re,A as oe}from"./AuthenticatedLayout-BmG-JgPz.js";import{P as ae}from"./PageLayout-B1HOzFqY.js";import{g as V,H as le,t as ne,F as S}from"./icons-Bl42yKt2.js";import"./useAuth-Bp6rU6h2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PageHeader-DKg8lzbe.js";import"./Icon-DbKLKyO0.js";import"./UsersIcon-pG6yzMl7.js";function de(B,u){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})])}const ie={class:"max-w-4xl mx-auto space-y-6"},ue={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},me={class:"px-6 py-4 border-b border-gray-200 bg-gray-50"},ce={class:"flex items-center justify-between"},pe={class:"flex items-center space-x-2"},ye={class:"p-6"},ve={class:"mb-4"},ge={class:"flex justify-between text-sm text-gray-600 mb-2"},be={class:"w-full bg-gray-200 rounded-full h-2"},xe={class:"flex justify-between text-xs text-gray-500 mt-1"},fe={key:0,class:"text-yellow-600"},he={key:1},we={class:"space-y-2"},ke={key:0,class:"text-sm text-gray-600"},_e={key:1,class:"text-sm text-green-600"},Ce={key:2,class:"text-sm text-red-600"},Se={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200"},De={class:"p-6"},Ee={class:"mt-4"},Fe={class:"text-lg font-medium text-gray-900"},Te={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg"},Me={class:"flex items-center justify-between"},Ie={class:"flex items-center space-x-3"},Re={class:"text-sm font-medium text-gray-900"},je={class:"text-xs text-gray-500"},Ne={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Pe={class:"p-6 space-y-6"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"block text-xs font-medium text-gray-600"},qe=["onUpdate:modelValue"],Ae=["value"],ze={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ue={class:"space-y-3"},$e={class:"flex items-center"},He={class:"flex items-center"},Le={class:"flex items-center"},Je={class:"flex justify-end pt-4"},Oe=["disabled"],We={key:3,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Qe={class:"p-6"},Ge={class:"flex space-x-3"},Ke={key:4,class:"bg-white rounded-lg shadow-sm border border-gray-200"},Xe={class:"p-6"},Ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Ze={class:"text-center p-4 bg-green-50 rounded-lg"},et={class:"text-2xl font-bold text-green-600"},tt={class:"text-center p-4 bg-red-50 rounded-lg"},st={class:"text-2xl font-bold text-red-600"},rt={class:"text-center p-4 bg-teal-50 rounded-lg"},ot={class:"text-2xl font-bold text-teal-600"},at={key:0,class:"mt-6"},lt={class:"bg-red-50 border border-red-200 rounded-md p-4 max-h-60 overflow-y-auto"},nt={class:"flex justify-end mt-6 space-x-3"},bt={__name:"Import",props:{departments:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]}},setup(B){const u=b(null),D=b(!1),x=b([]),g=b({}),m=b({batchSize:25,errorHandling:"continue",skipFirstRow:!0,updateExisting:!1,sendWelcomeEmails:!0}),r=b({active:!1,paused:!1,canPause:!0,fileName:"",progress:0,processed:0,total:0,successCount:0,errorCount:0,currentRecord:"",estimatedTime:""}),p=b(null),E=[{key:"name",label:"Full Name",required:!0},{key:"email",label:"Email Address",required:!0},{key:"job_title",label:"Job Title",required:!1},{key:"department",label:"Department",required:!1},{key:"phone",label:"Phone Number",required:!1},{key:"join_date",label:"Join Date",required:!1},{key:"salary",label:"Salary",required:!1},{key:"contract_type",label:"Contract Type",required:!1},{key:"role",label:"Role",required:!1}],q=[{label:"Dashboard",href:route("dashboard")},{label:"Employees",href:route("employees.index")},{label:"Import",current:!0}],A=[{id:"back",label:"Back to Employees",variant:"secondary",handler:()=>Z.visit(route("employees.index"))}],F=K(()=>u.value?E.filter(e=>e.required).every(e=>g.value[e.key]):!1),z=o=>{o.preventDefault(),D.value=!1;const e=o.dataTransfer.files;e.length>0&&T({target:{files:e}})},T=async o=>{const e=o.target.files[0];if(!e)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(e.type)&&!e.name.match(/\.(xlsx|xls|csv)$/i)){alert("Please select a valid Excel or CSV file.");return}if(e.size>10*1024*1024){alert("File size must be less than 10MB.");return}u.value=e,await U(e)},U=async o=>{try{const e=new FormData;e.append("file",o);const s=await P.post(route("employees.import.preview"),e,{headers:{"Content-Type":"multipart/form-data"}});x.value=s.data.columns,M()}catch(e){console.error("Failed to detect columns:",e),x.value=["Name","Full Name","Employee Name","Email","Email Address","Work Email","Job Title","Position","Department","Dept","Division","Phone","Phone Number","Mobile","Join Date","Start Date","Hire Date","Salary","Basic Salary","Annual Salary","Contract Type","Employment Type","Status","Role","User Role","System Role","Access Role"],M()}},M=()=>{const o={name:["name","full name","employee name","full_name","employee_name"],email:["email","email address","work email","email_address","work_email"],job_title:["job title","position","job_title"],department:["department","dept","division"],phone:["phone","phone number","mobile","phone_number"],join_date:["join date","start date","hire date","join_date","start_date","hire_date"],salary:["salary","basic salary","annual salary","basic_salary","annual_salary"],contract_type:["contract type","employment type","status","contract_type","employment_type"],role:["role","user role","system role","access role","permission role","user_role"]};Object.keys(o).forEach(e=>{const s=x.value.find(n=>o[e].includes(n.toLowerCase()));s&&(g.value[e]=s)})},$=()=>{u.value=null,x.value=[],g.value={}},H=o=>{if(o===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,n)).toFixed(2))+" "+s[n]},L=async()=>{var e,s;if(!F.value)return;const o=new FormData;o.append("file",u.value),o.append("column_mapping",JSON.stringify(g.value)),o.append("options",JSON.stringify(m.value)),r.value={active:!0,paused:!1,canPause:!0,fileName:u.value.name,progress:0,processed:0,total:0,successCount:0,errorCount:0,currentRecord:"",estimatedTime:"Calculating..."};try{const n=await P.post(route("employees.import.store"),o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:R=>{const G=Math.round(R.loaded*100/R.total);r.value.progress=G}});if(n.data.success)p.value=n.data.results,r.value.active=!1;else throw new Error(n.data.message)}catch(n){console.error("Import failed:",n),alert("Import failed: "+(((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||n.message)),h()}},J=()=>{r.value.paused=!0},O=()=>{r.value.paused=!1},W=()=>{confirm("Are you sure you want to cancel the import? This action cannot be undone.")&&h()},h=()=>{u.value=null,x.value=[],g.value={},r.value={active:!1,paused:!1,canPause:!0,fileName:"",progress:0,processed:0,total:0,successCount:0,errorCount:0,currentRecord:"",estimatedTime:""},p.value=null},I=o=>{window.open(route("employees.template",{format:o}),"_blank")},Q=()=>{console.log("Downloading error report...")};return X(()=>{document.addEventListener("dragover",o=>o.preventDefault()),document.addEventListener("drop",o=>o.preventDefault())}),(o,e)=>(a(),Y(oe,null,{default:j(()=>[c(ae,{title:"Import Employees",subtitle:"Bulk import employees from Excel or CSV files",breadcrumbs:q,actions:A},{default:j(()=>[t("div",ie,[r.value.active?(a(),l("div",ue,[t("div",me,[t("div",ce,[e[13]||(e[13]=t("h3",{class:"text-lg font-medium text-gray-900"},"Import Progress",-1)),t("div",pe,[r.value.canPause&&!r.value.paused?(a(),l("button",{key:0,onClick:J,class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[c(y(se),{class:"w-4 h-4 mr-1"}),e[10]||(e[10]=v(" Pause "))])):i("",!0),r.value.paused?(a(),l("button",{key:1,onClick:O,class:"inline-flex items-center px-3 py-1.5 border border-green-300 shadow-sm text-sm font-medium rounded-md text-green-700 bg-green-50 hover:bg-green-100"},[c(y(re),{class:"w-4 h-4 mr-1"}),e[11]||(e[11]=v(" Resume "))])):i("",!0),t("button",{onClick:W,class:"inline-flex items-center px-3 py-1.5 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100"},[c(y(V),{class:"w-4 h-4 mr-1"}),e[12]||(e[12]=v(" Cancel "))])])])]),t("div",ye,[t("div",ve,[t("div",ge,[t("span",null,"Processing "+d(r.value.fileName),1),t("span",null,d(r.value.processed)+" / "+d(r.value.total)+" records",1)]),t("div",be,[t("div",{class:"bg-teal-600 h-2 rounded-full transition-all duration-300",style:ee({width:r.value.progress+"%"})},null,4)]),t("div",xe,[t("span",null,d(r.value.progress)+"% complete",1),r.value.paused?(a(),l("span",fe,"Paused")):r.value.estimatedTime?(a(),l("span",he,d(r.value.estimatedTime)+" remaining",1)):i("",!0)])]),t("div",we,[r.value.currentRecord?(a(),l("div",ke," Currently processing: "+d(r.value.currentRecord),1)):i("",!0),r.value.successCount>0?(a(),l("div",_e," ✓ "+d(r.value.successCount)+" employees imported successfully ",1)):i("",!0),r.value.errorCount>0?(a(),l("div",Ce," ✗ "+d(r.value.errorCount)+" errors encountered ",1)):i("",!0)])])])):i("",!0),r.value.active?i("",!0):(a(),l("div",Se,[e[16]||(e[16]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Upload File"),t("p",{class:"mt-1 text-sm text-gray-500"}," Select an Excel (.xlsx, .xls) or CSV file containing employee data ")],-1)),t("div",De,[t("div",{onDrop:z,onDragover:e[1]||(e[1]=N(()=>{},["prevent"])),onDragenter:e[2]||(e[2]=N(()=>{},["prevent"])),class:te(["border-2 border-dashed rounded-lg p-8 text-center transition-colors",D.value?"border-teal-400 bg-teal-50":"border-gray-300 hover:border-gray-400"])},[c(y(le),{class:"mx-auto h-12 w-12 text-gray-400"}),t("div",Ee,[t("p",Fe,[e[14]||(e[14]=v(" Drop your file here, or ")),t("button",{onClick:e[0]||(e[0]=s=>o.$refs.fileInput.click()),class:"text-teal-600 hover:text-teal-500 font-medium"}," browse ")]),e[15]||(e[15]=t("p",{class:"mt-2 text-sm text-gray-500"}," Supports Excel (.xlsx, .xls) and CSV files up to 10MB ",-1))]),t("input",{ref:"fileInput",type:"file",accept:".xlsx,.xls,.csv",onChange:T,class:"hidden"},null,544)],34),u.value?(a(),l("div",Te,[t("div",Me,[t("div",Ie,[c(y(ne),{class:"h-8 w-8 text-gray-400"}),t("div",null,[t("p",Re,d(u.value.name),1),t("p",je,d(H(u.value.size)),1)])]),t("button",{onClick:$,class:"text-gray-400 hover:text-gray-600"},[c(y(V),{class:"h-5 w-5"})])])])):i("",!0)])])),u.value&&!r.value.active?(a(),l("div",Ne,[e[28]||(e[28]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Import Options")],-1)),t("div",Pe,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Column Mapping ",-1)),t("div",Ve,[(a(),l(w,null,k(E,s=>t("div",{key:s.key,class:"space-y-2"},[t("label",Be,d(s.label)+" "+d(s.required?"*":""),1),f(t("select",{"onUpdate:modelValue":n=>g.value[s.key]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 text-sm"},[e[17]||(e[17]=t("option",{value:""},"Select column...",-1)),(a(!0),l(w,null,k(x.value,n=>(a(),l("option",{key:n,value:n},d(n),9,Ae))),128))],8,qe),[[_,g.value[s.key]]])])),64))])]),t("div",ze,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Batch Size ",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>m.value.batchSize=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500"},e[19]||(e[19]=[t("option",{value:"10"},"10 records per batch",-1),t("option",{value:"25"},"25 records per batch",-1),t("option",{value:"50"},"50 records per batch",-1),t("option",{value:"100"},"100 records per batch",-1)]),512),[[_,m.value.batchSize]]),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-500"}," Smaller batches are more reliable but slower ",-1))]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Error Handling ",-1)),f(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>m.value.errorHandling=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500"},e[22]||(e[22]=[t("option",{value:"continue"},"Continue on errors",-1),t("option",{value:"stop"},"Stop on first error",-1)]),512),[[_,m.value.errorHandling]])])]),t("div",Ue,[t("label",$e,[f(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>m.value.skipFirstRow=s),type:"checkbox",class:"rounded border-gray-300 text-teal-600 shadow-sm focus:border-teal-300 focus:ring focus:ring-teal-200 focus:ring-opacity-50"},null,512),[[C,m.value.skipFirstRow]]),e[24]||(e[24]=t("span",{class:"ml-2 text-sm text-gray-700"},"Skip first row (headers)",-1))]),t("label",He,[f(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.updateExisting=s),type:"checkbox",class:"rounded border-gray-300 text-teal-600 shadow-sm focus:border-teal-300 focus:ring focus:ring-teal-200 focus:ring-opacity-50"},null,512),[[C,m.value.updateExisting]]),e[25]||(e[25]=t("span",{class:"ml-2 text-sm text-gray-700"},"Update existing employees (match by email)",-1))]),t("label",Le,[f(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>m.value.sendWelcomeEmails=s),type:"checkbox",class:"rounded border-gray-300 text-teal-600 shadow-sm focus:border-teal-300 focus:ring focus:ring-teal-200 focus:ring-opacity-50"},null,512),[[C,m.value.sendWelcomeEmails]]),e[26]||(e[26]=t("span",{class:"ml-2 text-sm text-gray-700"},"Send welcome emails to new employees",-1))])]),t("div",Je,[t("button",{onClick:L,disabled:!F.value,class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 disabled:opacity-50 disabled:cursor-not-allowed"},[c(y(de),{class:"w-5 h-5 mr-2"}),e[27]||(e[27]=v(" Start Import "))],8,Oe)])])])):i("",!0),r.value.active?i("",!0):(a(),l("div",We,[e[32]||(e[32]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Need a Template?")],-1)),t("div",Qe,[e[31]||(e[31]=t("p",{class:"text-sm text-gray-600 mb-4"}," Download our template file to ensure your data is formatted correctly for import. ",-1)),t("div",Ge,[t("button",{onClick:e[8]||(e[8]=s=>I("excel")),class:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[c(y(S),{class:"w-4 h-4 mr-2"}),e[29]||(e[29]=v(" Download Excel Template "))]),t("button",{onClick:e[9]||(e[9]=s=>I("csv")),class:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[c(y(S),{class:"w-4 h-4 mr-2"}),e[30]||(e[30]=v(" Download CSV Template "))])])])])),p.value?(a(),l("div",Ke,[e[38]||(e[38]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Import Results")],-1)),t("div",Xe,[t("div",Ye,[t("div",Ze,[t("div",et,d(p.value.successful),1),e[33]||(e[33]=t("div",{class:"text-sm text-gray-600"},"Successful",-1))]),t("div",tt,[t("div",st,d(p.value.failed),1),e[34]||(e[34]=t("div",{class:"text-sm text-gray-600"},"Failed",-1))]),t("div",rt,[t("div",ot,d(p.value.total),1),e[35]||(e[35]=t("div",{class:"text-sm text-gray-600"},"Total Processed",-1))])]),p.value.errors&&p.value.errors.length>0?(a(),l("div",at,[e[36]||(e[36]=t("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Import Errors",-1)),t("div",lt,[(a(!0),l(w,null,k(p.value.errors,s=>(a(),l("div",{key:s.row,class:"text-sm text-red-700 mb-2"},[t("strong",null,"Row "+d(s.row)+":",1),v(" "+d(s.message),1)]))),128))])])):i("",!0),t("div",nt,[p.value.failed>0?(a(),l("button",{key:0,onClick:Q,class:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[c(y(S),{class:"w-4 h-4 mr-2"}),e[37]||(e[37]=v(" Download Error Report "))])):i("",!0),t("button",{onClick:h,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-teal-600 hover:bg-teal-700"}," Import Another File ")])])])):i("",!0)])]),_:1})]),_:1}))}};export{bt as default};
