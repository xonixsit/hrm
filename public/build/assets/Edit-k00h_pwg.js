import{x as L,Q as b,f as h,g as N,o as x,h as i,k as d,u as r,a as s,t as c,c as P,i as $}from"./app-BCMCFoSN.js";import{A as M}from"./AuthenticatedLayout-BIJYSeBp.js";import{P as j}from"./PageLayout-DPeTJvZR.js";import{F as R}from"./FormLayout-cY7YXFEL.js";import{F as S}from"./FormSection-DRpO8i1q.js";import{F as u}from"./FormField-m9FBSmV2.js";import{B as f}from"./BaseInput-EQmPyns1.js";import{B as y}from"./BaseSelect-DWfr-F9s.js";import{B as q}from"./BaseTextarea-NXwl55-U.js";import{I as T}from"./Icon-D-fzcfHK.js";import{b as Q,r as G,e as H}from"./icons-CiCy7ZGn.js";import"./useAuth-C0g2mN_s.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAccessibility-DCi0MZjm.js";import"./PageHeader.vue_vue_type_style_index_0_scoped_cac8c3e5_lang-B6Akxp6-.js";import"./PageHeader-BXwwwzcx.js";/* empty css                                                                   *//* empty css                                                                  *//* empty css                                                                   */const W={class:"bg-neutral-50 rounded-lg p-4 mb-6"},J={class:"flex items-center space-x-4"},K={class:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center"},X={class:"text-lg font-semibold text-neutral-900"},Y={class:"text-sm text-neutral-600"},Z={class:"flex items-center space-x-4 mt-1"},ee={class:"text-xs text-neutral-500"},te={key:0,class:"text-xs text-neutral-500"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},oe={class:"bg-neutral-50 rounded-lg p-4"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},de={class:"text-neutral-600"},se={class:"text-neutral-600"},Ue={__name:"Edit",props:{department:{type:Object,required:!0},employees:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},setup(p){const a=p,e=L({name:a.department.name,code:a.department.code,description:a.department.description,budget:a.department.budget,location:a.department.location,status:a.department.status||"Active",established_date:a.department.established_date?new Date(a.department.established_date).toISOString().split("T")[0]:null,parent_department_id:a.department.parent_department_id?String(a.department.parent_department_id):null,manager_id:a.department.manager_id?String(a.department.manager_id):null}),D=[{label:"Dashboard",href:route("dashboard")},{label:"People Management",href:"#"},{label:"Departments",href:route("departments.index")},{label:a.department.name,href:route("departments.show",a.department.id)},{label:"Edit",current:!0}],w=[{id:"view-department",label:"View Details",icon:Q,variant:"secondary",handler:()=>b.visit(route("departments.show",a.department.id))},{id:"delete-department",label:"Delete Department",icon:G,variant:"danger",handler:()=>z(),disabled:a.department.employees_count>0}],A=h(()=>[{id:"cancel",label:"Cancel",type:"button",variant:"secondary",handler:()=>b.visit(route("departments.show",a.department.id))},{id:"reset",label:"Reset Changes",variant:"ghost",handler:()=>k(),disabled:!v.value},{id:"update",label:"Update Department",type:"submit",variant:"primary",icon:H,loadingLabel:"Updating Department...",disabled:!F.value||!v.value}]),F=h(()=>e.name&&e.name.trim().length>0),U=h(()=>a.employees.map(n=>({value:String(n.id),label:`${n.user.name} - ${n.job_title||"No title"}`}))),B=h(()=>a.departments.filter(n=>n.id!==a.department.id).map(n=>({value:String(n.id),label:n.name}))),E=[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"},{value:"Restructuring",label:"Restructuring"}],v=h(()=>{const n=l=>typeof l=="string"?l.trim():l,t=l=>l===""?null:l,o=l=>l===""?null:String(l);return n(e.name)!==n(a.department.name)||n(e.code)!==n(a.department.code)||n(e.description)!==n(a.department.description)||String(e.manager_id||"")!==String(a.department.manager_id||"")||o(e.parent_department_id)!==o(a.department.parent_department_id)||e.budget!==a.department.budget||n(e.location)!==n(a.department.location)||e.status!==(a.department.status||"Active")||t(e.established_date)!==t(a.department.established_date)}),C=n=>({Engineering:"code-bracket",Marketing:"megaphone",Sales:"chart-bar",HR:"users",Finance:"currency-dollar",Operations:"cog",Support:"lifebuoy",Legal:"scale",Design:"paint-brush",Product:"light-bulb"})[n]||"building-office",V=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",O=()=>{const n={};for(const t in e.data()){const o=a.department[t],l=e[t];["parent_department_id","manager_id","established_date"].includes(t)&&console.log(`Field: ${t}, Original:`,o,"Current:",l);const _=m=>typeof m=="string"?m.trim():m;if(["established_date","code","description","location"].includes(t)){const m=t==="established_date"?l===""?null:l:_(l),g=t==="established_date"?o===""?null:o:_(o);m!==g&&(n[t]=m)}else if(t==="name"){const m=_(l),g=_(o);m!==g&&(n[t]=m)}else if(["manager_id","parent_department_id"].includes(t)){const m=l===""||l===null?null:String(l),g=o===""||o===null?null:String(o);m!==g&&(n[t]=m)}else l!==o&&(n[t]=l)}if(Object.keys(n).length===0){b.visit(route("departments.show",a.department.id));return}e.put(route("departments.update",a.department.id),{data:n,onSuccess:()=>{console.log(n)},onError:t=>{console.error("Form submission errors:",t);const o=Object.keys(t)[0];if(o){const l=document.querySelector(`[name="${o}"]`);l&&(l.scrollIntoView({behavior:"smooth",block:"center"}),l.focus())}}})},k=()=>{confirm("Are you sure you want to reset all changes? This action cannot be undone.")&&(e.reset(),e.clearErrors())},z=()=>{if(a.department.employees_count>0){alert("Cannot delete department with employees. Please reassign employees first.");return}confirm(`Are you sure you want to delete ${a.department.name}? This action cannot be undone.`)&&b.delete(route("departments.destroy",a.department.id),{onSuccess:()=>{b.visit(route("departments.index"))},onError:()=>{alert("Failed to delete department. Please try again.")}})},I=n=>{n.handler&&typeof n.handler=="function"&&n.handler()};return(n,t)=>(x(),N(M,null,{default:i(()=>[d(j,{title:`Edit Department: ${p.department.name}`,subtitle:"Update department information and structure",breadcrumbs:D,actions:w},{default:i(()=>[d(R,{title:"Department Information",description:"Update the department's information below",actions:A.value,errors:r(e).errors,"is-submitting":r(e).processing,variant:"card",onSubmit:O,onAction:I},{default:i(()=>[s("div",W,[s("div",J,[s("div",K,[d(T,{name:C(p.department.name),class:"w-6 h-6 text-primary-600"},null,8,["name"])]),s("div",null,[s("h3",X,c(p.department.name),1),s("p",Y,c(p.department.code||"No code assigned"),1),s("div",Z,[s("span",ee,c(p.department.employees_count||0)+" employees ",1),p.department.manager?(x(),P("span",te," Manager: "+c(p.department.manager.user.name),1)):$("",!0)])])])]),d(S,{title:"Basic Information",description:"Essential details about the department"},{default:i(()=>[s("div",re,[d(u,{label:"Department Name",required:"",error:r(e).errors.name,help:"Enter the full name of the department"},{default:i(()=>[d(f,{modelValue:r(e).name,"onUpdate:modelValue":t[0]||(t[0]=o=>r(e).name=o),type:"text",placeholder:"Engineering",error:!!r(e).errors.name,required:""},null,8,["modelValue","error"])]),_:1},8,["error"]),d(u,{label:"Department Code",error:r(e).errors.code,help:"Short code for the department"},{default:i(()=>[d(f,{modelValue:r(e).code,"onUpdate:modelValue":t[1]||(t[1]=o=>r(e).code=o),type:"text",placeholder:"ENG",error:!!r(e).errors.code,maxlength:"10"},null,8,["modelValue","error"])]),_:1},8,["error"]),d(u,{label:"Description",error:r(e).errors.description,help:"Brief description of the department's purpose",class:"md:col-span-2"},{default:i(()=>[d(q,{modelValue:r(e).description,"onUpdate:modelValue":t[2]||(t[2]=o=>r(e).description=o),placeholder:"Describe the department's role and responsibilities...",error:!!r(e).errors.description,rows:"3"},null,8,["modelValue","error"])]),_:1},8,["error"])])]),_:1}),d(S,{title:"Management Structure",description:"Assign leadership and organizational details"},{default:i(()=>[s("div",ae,[d(u,{label:"Department Manager",error:r(e).errors.manager_id,help:"Select an employee to manage this department"},{default:i(()=>[d(y,{modelValue:r(e).manager_id,"onUpdate:modelValue":t[3]||(t[3]=o=>r(e).manager_id=o),options:U.value,"option-label":"label","option-value":"value",error:!!r(e).errors.manager_id,placeholder:"Select manager"},null,8,["modelValue","options","error"])]),_:1},8,["error"]),d(u,{label:"Parent Department",error:r(e).errors.parent_department_id,help:"Select a parent department if this is a sub-department"},{default:i(()=>[d(y,{modelValue:r(e).parent_department_id,"onUpdate:modelValue":t[4]||(t[4]=o=>r(e).parent_department_id=o),options:B.value,"option-label":"label","option-value":"value",error:!!r(e).errors.parent_department_id,placeholder:"Select parent department"},null,8,["modelValue","options","error"])]),_:1},8,["error"]),d(u,{label:"Budget",error:r(e).errors.budget,help:"Annual budget for this department"},{default:i(()=>[d(f,{modelValue:r(e).budget,"onUpdate:modelValue":t[5]||(t[5]=o=>r(e).budget=o),type:"number",placeholder:"100000",error:!!r(e).errors.budget,step:"1000",min:"0"},null,8,["modelValue","error"])]),_:1},8,["error"]),d(u,{label:"Location",error:r(e).errors.location,help:"Physical location or office"},{default:i(()=>[d(f,{modelValue:r(e).location,"onUpdate:modelValue":t[6]||(t[6]=o=>r(e).location=o),type:"text",placeholder:"Building A, Floor 2",error:!!r(e).errors.location},null,8,["modelValue","error"])]),_:1},8,["error"])]),s("div",ne,[d(u,{label:"Status",error:r(e).errors.status,help:"Current operational status"},{default:i(()=>[d(y,{modelValue:r(e).status,"onUpdate:modelValue":t[7]||(t[7]=o=>r(e).status=o),options:E,"option-label":"label","option-value":"value",error:!!r(e).errors.status,placeholder:"Select status"},null,8,["modelValue","error"])]),_:1},8,["error"]),d(u,{label:"Established Date",error:r(e).errors.established_date,help:"When was this department established"},{default:i(()=>[d(f,{modelValue:r(e).established_date,"onUpdate:modelValue":t[8]||(t[8]=o=>r(e).established_date=o),type:"date",error:!!r(e).errors.established_date},null,8,["modelValue","error"])]),_:1},8,["error"])]),s("div",oe,[s("div",le,[s("div",null,[t[9]||(t[9]=s("span",{class:"font-medium text-neutral-700"},"Created:",-1)),s("p",de,c(V(p.department.created_at)),1)]),s("div",null,[t[10]||(t[10]=s("span",{class:"font-medium text-neutral-700"},"Last Updated:",-1)),s("p",se,c(V(p.department.updated_at)),1)])])])]),_:1})]),_:1},8,["actions","errors","is-submitting"])]),_:1},8,["title"])]),_:1}))}};export{Ue as default};
