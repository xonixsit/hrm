<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Work Duration Timer - Dashboard Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 2.5rem;
            font-weight: bold;
            color: #059669;
            text-align: center;
            padding: 2rem;
            background: linear-gradient(to right, #f0fdf4, #ecfdf5);
            border: 2px solid #10b981;
            border-radius: 1rem;
            margin: 1rem 0;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.1);
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .status-clocked-in {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534;
            border: 2px solid #22c55e;
        }
        
        .status-clocked-out {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            color: #374151;
            border: 2px solid #9ca3af;
        }
        
        .status-on-break {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 2px solid #f59e0b;
        }
        
        .control-button {
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .clock-in-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .clock-out-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .break-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .break-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .stat-card {
            padding: 1.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
            font-family: 'Courier New', monospace;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #6b7280;
            margin-top: 0.5rem;
            font-weight: 500;
        }
        
        .debug-info {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            justify-between;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            border-left: 4px solid #10b981;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen p-8">
    <div id="app">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">
                    üïê Real-time Work Duration Timer Test
                </h1>
                <p class="text-lg text-gray-600">
                    Testing the dashboard timer functionality with live updates
                </p>
            </div>
            
            <!-- Current Time Display -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 text-center">Current Time</h2>
                <div class="text-center">
                    <div class="text-5xl font-mono font-bold text-blue-600 mb-2">{{ currentTime }}</div>
                    <div class="text-lg text-gray-600">{{ currentDate }}</div>
                    <div class="text-sm text-gray-500 mt-2">{{ timezone }}</div>
                </div>
            </div>
            
            <!-- Timer Status and Controls -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 text-center">Work Timer Dashboard</h2>
                
                <!-- Status Indicator -->
                <div class="text-center mb-6">
                    <span :class="statusClasses" class="pulse">
                        <span class="w-3 h-3 rounded-full bg-current inline-block mr-3"></span>
                        {{ statusText }}
                    </span>
                </div>
                
                <!-- Real-time Work Duration Display -->
                <div v-if="clockedIn && !onBreak" class="timer-display pulse">
                    {{ realTimeWorkDuration }}
                    <div class="text-lg font-normal text-green-600 mt-2">Active Work Session</div>
                </div>
                
                <div v-else-if="clockedIn && onBreak" class="timer-display" style="background: linear-gradient(to right, #fef3c7, #fde68a); color: #92400e; border-color: #f59e0b;">
                    {{ realTimeWorkDuration }}
                    <div class="text-lg font-normal text-yellow-700 mt-2">On Break - Timer Paused</div>
                </div>
                
                <div v-else class="text-center text-gray-500 py-12">
                    <div class="text-8xl mb-6">‚è∞</div>
                    <p class="text-xl">Clock in to start tracking your work time</p>
                    <p class="text-sm text-gray-400 mt-2">Your timer will update in real-time</p>
                </div>
                
                <!-- Control Buttons -->
                <div class="text-center mt-8">
                    <button
                        @click="toggleClockInOut"
                        :class="clockedIn ? 'clock-out-btn' : 'clock-in-btn'"
                        class="control-button"
                    >
                        {{ clockedIn ? 'üî¥ Clock Out' : 'üü¢ Clock In' }}
                    </button>
                    
                    <button
                        v-if="clockedIn"
                        @click="toggleBreak"
                        :disabled="false"
                        :class="onBreak ? 'break-btn' : 'break-btn'"
                        class="control-button"
                    >
                        {{ onBreak ? '‚ñ∂Ô∏è End Break' : '‚è∏Ô∏è Take Break' }}
                    </button>
                </div>
            </div>
            
            <!-- Statistics Dashboard -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 text-center">Today's Statistics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ totalWorkTime }}</div>
                        <div class="stat-label">Total Work Time</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">{{ totalBreakTime }}</div>
                        <div class="stat-label">Break Time</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">{{ workSessions }}</div>
                        <div class="stat-label">Work Sessions</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">{{ efficiency }}%</div>
                        <div class="stat-label">Work Efficiency</div>
                    </div>
                </div>
            </div>
            
            <!-- Activity Log -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6">Activity Log</h2>
                
                <div v-if="activityLog.length === 0" class="text-center text-gray-500 py-8">
                    <div class="text-6xl mb-4">üìù</div>
                    <p class="text-lg">No activities recorded yet</p>
                    <p class="text-sm text-gray-400">Start working to see your activity timeline</p>
                </div>
                
                <div v-else class="activity-log">
                    <div
                        v-for="(activity, index) in activityLog.slice().reverse()"
                        :key="index"
                        class="activity-item"
                    >
                        <div class="flex items-center space-x-4">
                            <span class="text-3xl">{{ getActivityIcon(activity.type) }}</span>
                            <div>
                                <div class="font-semibold text-gray-900">{{ activity.action }}</div>
                                <div class="text-sm text-gray-600">{{ activity.time }}</div>
                            </div>
                        </div>
                        <div v-if="activity.duration" class="text-lg font-mono text-gray-700 font-bold">
                            {{ activity.duration }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Debug Information -->
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-semibold mb-6">Debug Information</h2>
                
                <div class="debug-info">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <div><strong>Clocked In:</strong> {{ clockedIn }}</div>
                            <div><strong>On Break:</strong> {{ onBreak }}</div>
                            <div><strong>Clock In Time:</strong> {{ clockInTime || 'Not set' }}</div>
                            <div><strong>Break Start Time:</strong> {{ breakStartTime || 'Not set' }}</div>
                        </div>
                        <div>
                            <div><strong>Real-time Duration:</strong> {{ realTimeWorkDuration }}</div>
                            <div><strong>Timer Active:</strong> {{ timerActive }}</div>
                            <div><strong>Update Interval:</strong> {{ updateInterval }}ms</div>
                            <div><strong>Last Update:</strong> {{ lastUpdate }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                // State
                const clockedIn = ref(false);
                const onBreak = ref(false);
                const clockInTime = ref(null);
                const breakStartTime = ref(null);
                const currentTime = ref('');
                const currentDate = ref('');
                const timezone = ref('');
                const realTimeWorkDuration = ref('0h 0m 0s');
                const timerActive = ref(false);
                const updateInterval = ref(1000);
                const lastUpdate = ref('');
                
                // Statistics
                const totalWorkTime = ref('0h 0m');
                const totalBreakTime = ref('0h 0m');
                const workSessions = ref(0);
                const activityLog = ref([]);
                
                // Timers
                let timeUpdateInterval = null;
                let workDurationInterval = null;
                
                // Computed properties
                const statusText = computed(() => {
                    if (onBreak.value) return 'On Break';
                    if (clockedIn.value) return 'Working - Timer Active';
                    return 'Clocked Out';
                });
                
                const statusClasses = computed(() => [
                    'status-indicator',
                    {
                        'status-clocked-in': clockedIn.value && !onBreak.value,
                        'status-on-break': onBreak.value,
                        'status-clocked-out': !clockedIn.value
                    }
                ]);
                
                const efficiency = computed(() => {
                    const totalWork = parseTimeString(totalWorkTime.value);
                    const totalBreak = parseTimeString(totalBreakTime.value);
                    const total = totalWork + totalBreak;
                    
                    if (total === 0) return 100;
                    return Math.round((totalWork / total) * 100);
                });
                
                // Methods
                const updateCurrentTime = () => {
                    const now = new Date();
                    currentTime.value = now.toLocaleTimeString('en-US', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    
                    currentDate.value = now.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    timezone.value = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    lastUpdate.value = now.toISOString();
                };
                
                const updateWorkDuration = () => {
                    if (clockedIn.value && clockInTime.value && !onBreak.value) {
                        const clockIn = new Date(clockInTime.value);
                        const now = new Date();
                        const diffMs = now - clockIn;
                        
                        const hours = Math.floor(diffMs / (1000 * 60 * 60));
                        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);
                        
                        realTimeWorkDuration.value = `${hours}h ${minutes}m ${seconds}s`;
                        timerActive.value = true;
                        
                        // Update total work time
                        totalWorkTime.value = `${hours}h ${minutes}m`;
                        
                        console.log('Timer updated:', realTimeWorkDuration.value);
                    } else {
                        timerActive.value = false;
                        if (!clockedIn.value) {
                            realTimeWorkDuration.value = '0h 0m 0s';
                        }
                    }
                };
                
                const toggleClockInOut = () => {
                    if (clockedIn.value) {
                        // Clock out
                        clockedIn.value = false;
                        onBreak.value = false;
                        
                        const clockOutTime = new Date();
                        const duration = clockInTime.value ? 
                            formatDuration(clockOutTime - new Date(clockInTime.value)) : '0h 0m';
                        
                        addActivity('clock-out', 'Clocked Out', clockOutTime, duration);
                        
                        clockInTime.value = null;
                        breakStartTime.value = null;
                        realTimeWorkDuration.value = '0h 0m 0s';
                        
                        console.log('Clocked out successfully');
                    } else {
                        // Clock in
                        clockedIn.value = true;
                        clockInTime.value = new Date().toISOString();
                        workSessions.value++;
                        
                        addActivity('clock-in', 'Clocked In', new Date());
                        
                        console.log('Clocked in successfully at:', clockInTime.value);
                    }
                };
                
                const toggleBreak = () => {
                    if (onBreak.value) {
                        // End break
                        onBreak.value = false;
                        
                        const breakEndTime = new Date();
                        const breakDuration = breakStartTime.value ? 
                            formatDuration(breakEndTime - new Date(breakStartTime.value)) : '0h 0m';
                        
                        addActivity('break-end', 'Break Ended', breakEndTime, breakDuration);
                        
                        // Update total break time
                        const currentBreak = parseTimeString(totalBreakTime.value);
                        const additionalBreak = parseTimeString(breakDuration);
                        totalBreakTime.value = formatTimeString(currentBreak + additionalBreak);
                        
                        breakStartTime.value = null;
                        
                        console.log('Break ended');
                    } else {
                        // Start break
                        onBreak.value = true;
                        breakStartTime.value = new Date().toISOString();
                        
                        addActivity('break-start', 'Break Started', new Date());
                        
                        console.log('Break started');
                    }
                };
                
                const addActivity = (type, action, time, duration = null) => {
                    activityLog.value.push({
                        type,
                        action,
                        time: time.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        }),
                        duration
                    });
                };
                
                const getActivityIcon = (type) => {
                    const icons = {
                        'clock-in': 'üü¢',
                        'clock-out': 'üî¥',
                        'break-start': '‚è∏Ô∏è',
                        'break-end': '‚ñ∂Ô∏è'
                    };
                    return icons[type] || 'üìù';
                };
                
                const formatDuration = (ms) => {
                    const hours = Math.floor(ms / (1000 * 60 * 60));
                    const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
                    return `${hours}h ${minutes}m`;
                };
                
                const parseTimeString = (timeStr) => {
                    if (!timeStr || typeof timeStr !== 'string') return 0;
                    
                    const match = timeStr.match(/(\d+)h\s*(\d+)m/);
                    if (match) {
                        return parseInt(match[1]) + (parseInt(match[2]) / 60);
                    }
                    
                    return 0;
                };
                
                const formatTimeString = (hours) => {
                    const h = Math.floor(hours);
                    const m = Math.round((hours - h) * 60);
                    return `${h}h ${m}m`;
                };
                
                // Lifecycle
                onMounted(() => {
                    console.log('üöÄ Real-time work duration timer test initialized');
                    
                    // Initialize time display
                    updateCurrentTime();
                    updateWorkDuration();
                    
                    // Start intervals
                    timeUpdateInterval = setInterval(updateCurrentTime, 1000);
                    workDurationInterval = setInterval(updateWorkDuration, 1000);
                    
                    console.log('‚úÖ Timers started - updating every second');
                });
                
                onUnmounted(() => {
                    if (timeUpdateInterval) clearInterval(timeUpdateInterval);
                    if (workDurationInterval) clearInterval(workDurationInterval);
                    console.log('üõë Timers stopped');
                });
                
                return {
                    // State
                    clockedIn,
                    onBreak,
                    clockInTime,
                    breakStartTime,
                    currentTime,
                    currentDate,
                    timezone,
                    realTimeWorkDuration,
                    timerActive,
                    updateInterval,
                    lastUpdate,
                    
                    // Statistics
                    totalWorkTime,
                    totalBreakTime,
                    workSessions,
                    activityLog,
                    
                    // Computed
                    statusText,
                    statusClasses,
                    efficiency,
                    
                    // Methods
                    toggleClockInOut,
                    toggleBreak,
                    getActivityIcon
                };
            }
        }).mount('#app');
    </script>
</body>
</html>