<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clock In/Out Functionality Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 3rem;
            font-weight: bold;
            color: #059669;
            text-align: center;
            padding: 2rem;
            background: linear-gradient(to right, #f0fdf4, #ecfdf5);
            border: 3px solid #10b981;
            border-radius: 1rem;
            margin: 1rem 0;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.2);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            border-radius: 1rem;
            font-weight: 700;
            font-size: 1.2rem;
            margin: 1rem 0;
        }
        
        .status-clocked-in {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534;
            border: 3px solid #22c55e;
        }
        
        .status-clocked-out {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            color: #374151;
            border: 3px solid #9ca3af;
        }
        
        .control-button {
            padding: 1.25rem 2.5rem;
            border-radius: 1rem;
            font-weight: 700;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0.5rem;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .control-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .clock-in-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .clock-out-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .debug-section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            font-family: monospace;
        }
        
        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #22c55e;
            margin: 1rem 0;
        }
        
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #ef4444;
            margin: 1rem 0;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen p-8">
    <div id="app">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">
                    üïê Clock In/Out Functionality Test
                </h1>
                <p class="text-lg text-gray-600">
                    Testing the real-time timer with API integration
                </p>
            </div>
            
            <!-- Status Display -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="text-center mb-6">
                    <span :class="statusClasses">
                        <span class="w-4 h-4 rounded-full bg-current inline-block mr-3"></span>
                        {{ statusText }}
                    </span>
                </div>
                
                <!-- Real-time Timer Display -->
                <div v-if="clockedIn" class="timer-display">
                    {{ realTimeWorkDuration }}
                    <div class="text-lg font-normal text-green-600 mt-2">
                        Timer Active - Updates Every Second
                    </div>
                </div>
                
                <div v-else class="text-center text-gray-500 py-12">
                    <div class="text-8xl mb-6">‚è∞</div>
                    <p class="text-xl">Click "Clock In" to start the real-time timer</p>
                </div>
                
                <!-- Control Button -->
                <div class="text-center mt-8">
                    <button
                        @click="toggleClockInOut"
                        :disabled="loading"
                        :class="clockedIn ? 'clock-out-btn' : 'clock-in-btn'"
                        class="control-button"
                    >
                        {{ loading ? '‚è≥ Processing...' : (clockedIn ? 'üî¥ Clock Out' : 'üü¢ Clock In') }}
                    </button>
                </div>
            </div>
            
            <!-- Messages -->
            <div v-if="successMessage" class="success-message">
                ‚úÖ {{ successMessage }}
            </div>
            
            <div v-if="errorMessage" class="error-message">
                ‚ùå {{ errorMessage }}
            </div>
            
            <!-- Debug Information -->
            <div class="debug-section">
                <h3 class="text-xl font-bold mb-4">Debug Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <div><strong>Clocked In:</strong> {{ clockedIn }}</div>
                        <div><strong>Clock In Time:</strong> {{ clockInTime || 'Not set' }}</div>
                        <div><strong>Loading:</strong> {{ loading }}</div>
                    </div>
                    <div>
                        <div><strong>Real-time Duration:</strong> {{ realTimeWorkDuration }}</div>
                        <div><strong>Timer Active:</strong> {{ timerActive }}</div>
                        <div><strong>Last Update:</strong> {{ lastUpdate }}</div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h4 class="font-bold">Expected Behavior:</h4>
                    <ul class="list-disc list-inside text-sm mt-2">
                        <li>Click "Clock In" ‚Üí Status changes to "Clocked In"</li>
                        <li>Timer appears and starts counting: 0h 0m 1s, 0h 0m 2s, etc.</li>
                        <li>Timer updates every second</li>
                        <li>Click "Clock Out" ‚Üí Timer disappears, status changes to "Clocked Out"</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                // State
                const clockedIn = ref(false);
                const clockInTime = ref(null);
                const loading = ref(false);
                const realTimeWorkDuration = ref('0h 0m 0s');
                const timerActive = ref(false);
                const lastUpdate = ref('');
                const successMessage = ref('');
                const errorMessage = ref('');
                
                // Timer
                let workDurationInterval = null;
                
                // Computed
                const statusText = computed(() => {
                    return clockedIn.value ? 'Clocked In - Timer Active' : 'Clocked Out';
                });
                
                const statusClasses = computed(() => [
                    'status-indicator',
                    clockedIn.value ? 'status-clocked-in' : 'status-clocked-out'
                ]);
                
                // Methods
                const updateWorkDuration = () => {
                    if (clockedIn.value && clockInTime.value) {
                        const clockIn = new Date(clockInTime.value);
                        const now = new Date();
                        const diffMs = now - clockIn;
                        
                        const hours = Math.floor(diffMs / (1000 * 60 * 60));
                        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);
                        
                        realTimeWorkDuration.value = `${hours}h ${minutes}m ${seconds}s`;
                        timerActive.value = true;
                        lastUpdate.value = now.toLocaleTimeString();
                        
                        console.log('Timer updated:', realTimeWorkDuration.value);
                    } else {
                        realTimeWorkDuration.value = '0h 0m 0s';
                        timerActive.value = false;
                    }
                };
                
                const toggleClockInOut = async () => {
                    loading.value = true;
                    successMessage.value = '';
                    errorMessage.value = '';
                    
                    try {
                        if (clockedIn.value) {
                            // Simulate clock out
                            console.log('Clocking out...');
                            
                            // Simulate API delay
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            
                            // Update state
                            clockedIn.value = false;
                            clockInTime.value = null;
                            realTimeWorkDuration.value = '0h 0m 0s';
                            
                            successMessage.value = 'Successfully clocked out! Timer stopped.';
                            console.log('Clock out successful');
                        } else {
                            // Simulate clock in
                            console.log('Clocking in...');
                            
                            // Simulate API delay
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            
                            // Update state
                            clockedIn.value = true;
                            clockInTime.value = new Date().toISOString();
                            
                            successMessage.value = 'Successfully clocked in! Timer started.';
                            console.log('Clock in successful, timer should start now');
                            
                            // Start timer immediately
                            updateWorkDuration();
                        }
                    } catch (error) {
                        console.error('Clock in/out failed:', error);
                        errorMessage.value = 'Clock in/out failed: ' + error.message;
                    } finally {
                        loading.value = false;
                    }
                };
                
                // Lifecycle
                onMounted(() => {
                    console.log('üöÄ Clock in/out test initialized');
                    
                    // Start work duration interval
                    workDurationInterval = setInterval(updateWorkDuration, 1000);
                    
                    console.log('‚úÖ Timer interval started - will update every second when clocked in');
                });
                
                onUnmounted(() => {
                    if (workDurationInterval) {
                        clearInterval(workDurationInterval);
                        console.log('üõë Timer interval stopped');
                    }
                });
                
                return {
                    // State
                    clockedIn,
                    clockInTime,
                    loading,
                    realTimeWorkDuration,
                    timerActive,
                    lastUpdate,
                    successMessage,
                    errorMessage,
                    
                    // Computed
                    statusText,
                    statusClasses,
                    
                    // Methods
                    toggleClockInOut
                };
            }
        }).mount('#app');
    </script>
</body>
</html>