<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Creation - Multiple Selection Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div id="app">
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">
            <h1 class="text-2xl font-bold mb-6">Assessment Creation - Multiple Employee Selection</h1>
            
            <!-- Form State Display -->
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h3 class="font-medium text-blue-900 mb-2">Form State:</h3>
                <pre class="text-sm text-blue-800">{{ JSON.stringify(form, null, 2) }}</pre>
            </div>

            <!-- Employee Search -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Search Employees
                </label>
                <input
                    v-model="employeeSearch"
                    type="text"
                    placeholder="Type employee name..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
            </div>

            <!-- Employee List -->
            <div v-if="displayedEmployees.length > 0" class="mb-6 border border-gray-200 rounded-lg max-h-64 overflow-y-auto">
                <div
                    v-for="employee in displayedEmployees"
                    :key="employee.id"
                    @click="selectEmployee(employee)"
                    class="employee-option"
                    :class="{ 'selected': form.employee_ids.includes(employee.id) }"
                >
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-medium text-sm">
                                {{ getInitials(employee.name) }}
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900">{{ employee.name }}</h4>
                                <p class="text-sm text-gray-600">{{ employee.position }}</p>
                            </div>
                        </div>
                        <div class="flex-shrink-0">
                            <div 
                                v-if="form.employee_ids.includes(employee.id)" 
                                class="w-5 h-5 bg-blue-600 text-white rounded flex items-center justify-center text-xs"
                            >
                                ✓
                            </div>
                            <div v-else class="w-5 h-5 border-2 border-gray-300 rounded"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Selected Employees Display -->
            <div v-if="selectedEmployees.length > 0" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-medium text-gray-900">
                        Selected Employees ({{ selectedEmployees.length }})
                    </h3>
                    <button
                        @click="clearAllEmployees"
                        class="text-sm text-red-600 hover:text-red-800"
                    >
                        Clear All
                    </button>
                </div>
                <div class="space-y-2">
                    <div
                        v-for="employee in selectedEmployees"
                        :key="employee.id"
                        class="flex items-center justify-between p-2 bg-white border border-green-200 rounded"
                    >
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-medium text-xs">
                                {{ getInitials(employee.name) }}
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 text-sm">{{ employee.name }}</p>
                                <p class="text-xs text-gray-600">{{ employee.position }}</p>
                            </div>
                        </div>
                        <button
                            @click="removeEmployee(employee.id)"
                            class="text-red-500 hover:text-red-700 text-sm"
                        >
                            ✕
                        </button>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end">
                <button
                    @click="handleSubmit"
                    :disabled="!canSubmit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
                >
                    {{ form.employee_ids.length > 1 ? `Create ${form.employee_ids.length} Assessments` : 'Create Assessment' }}
                </button>
            </div>

            <!-- Debug Info -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-medium text-gray-900 mb-2">Debug Info:</h3>
                <p class="text-sm text-gray-600">Selected IDs: {{ form.employee_ids }}</p>
                <p class="text-sm text-gray-600">Selected Count: {{ selectedEmployees.length }}</p>
                <p class="text-sm text-gray-600">Can Submit: {{ canSubmit }}</p>
                <p class="text-sm text-gray-600">Search Term: "{{ employeeSearch }}"</p>
                <p class="text-sm text-gray-600">Displayed Employees: {{ displayedEmployees.length }}</p>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                // Sample data matching the Laravel structure
                const employees = ref([
                    { id: 1, name: 'John Doe', position: 'Software Engineer', department: { name: 'Engineering' } },
                    { id: 2, name: 'Jane Smith', position: 'Product Manager', department: { name: 'Product' } },
                    { id: 3, name: 'Mike Johnson', position: 'Designer', department: { name: 'Design' } },
                    { id: 4, name: 'Sarah Wilson', position: 'Data Analyst', department: { name: 'Analytics' } },
                    { id: 5, name: 'Tom Brown', position: 'DevOps Engineer', department: { name: 'Engineering' } },
                    { id: 6, name: 'Lisa Davis', position: 'QA Engineer', department: { name: 'Engineering' } }
                ]);

                const employeeSearch = ref('');

                // Form structure matching Laravel Inertia form
                const form = ref({
                    employee_ids: [],
                    competency_id: null,
                    assessment_type: 'manager',
                    assessment_cycle_id: null,
                    processing: false
                });

                // Computed properties matching the Vue component
                const filteredEmployees = computed(() => {
                    let filtered = employees.value;

                    if (employeeSearch.value && employeeSearch.value.length >= 1) {
                        const searchTerm = employeeSearch.value.toLowerCase();
                        filtered = filtered.filter(employee => 
                            employee.name.toLowerCase().includes(searchTerm) ||
                            (employee.position && employee.position.toLowerCase().includes(searchTerm))
                        );
                    }

                    return filtered.sort((a, b) => a.name.localeCompare(b.name));
                });

                const displayedEmployees = computed(() => {
                    if (!employeeSearch.value || employeeSearch.value.length === 0) {
                        return employees.value.slice(0, 10);
                    }
                    
                    return filteredEmployees.value.slice(0, 8);
                });

                const selectedEmployees = computed(() => {
                    return employees.value.filter(e => form.value.employee_ids.includes(e.id));
                });

                const canSubmit = computed(() => {
                    return form.value.employee_ids.length > 0 && !form.value.processing;
                });

                // Methods matching the Vue component
                const getInitials = (name) => {
                    return name
                        .split(' ')
                        .map(word => word.charAt(0))
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                };

                const selectEmployee = (employee) => {
                    console.log('Selecting employee:', employee.name);
                    console.log('Current employee_ids before:', form.value.employee_ids);
                    
                    const index = form.value.employee_ids.indexOf(employee.id);
                    if (index > -1) {
                        // Employee already selected, remove them
                        form.value.employee_ids.splice(index, 1);
                        console.log('Removed employee:', employee.name);
                    } else {
                        // Employee not selected, add them
                        form.value.employee_ids.push(employee.id);
                        console.log('Added employee:', employee.name);
                    }
                    
                    console.log('Current employee_ids after:', form.value.employee_ids);
                };

                const removeEmployee = (employeeId) => {
                    const index = form.value.employee_ids.indexOf(employeeId);
                    if (index > -1) {
                        form.value.employee_ids.splice(index, 1);
                    }
                };

                const clearAllEmployees = () => {
                    form.value.employee_ids = [];
                };

                const handleSubmit = () => {
                    if (form.value.employee_ids.length === 0) {
                        alert('Please select at least one employee');
                        return;
                    }

                    console.log('Submitting form with data:', form.value);
                    alert(`Would create ${form.value.employee_ids.length} assessment(s) for employees: ${selectedEmployees.value.map(e => e.name).join(', ')}`);
                };

                return {
                    employees,
                    employeeSearch,
                    form,
                    filteredEmployees,
                    displayedEmployees,
                    selectedEmployees,
                    canSubmit,
                    getInitials,
                    selectEmployee,
                    removeEmployee,
                    clearAllEmployees,
                    handleSubmit
                };
            }
        }).mount('#app');
    </script>

    <style>
        .employee-option {
            @apply p-4 cursor-pointer transition-all duration-200 hover:bg-gray-50 border-b border-gray-100 last:border-b-0;
        }

        .employee-option.selected {
            @apply bg-blue-50 border-blue-200;
        }

        .employee-option:hover {
            @apply bg-gray-50;
        }

        .employee-option.selected:hover {
            @apply bg-blue-100;
        }
    </style>
</body>
</html>