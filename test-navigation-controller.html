<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NavigationController Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .test-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 10px 0;
        }
        .debug-info {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .navigation-display {
            border: 2px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .desktop-nav {
            background: #e3f2fd;
            color: #1976d2;
        }
        .mobile-nav {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .desktop-btn {
            background: #2196f3;
            color: white;
        }
        .mobile-btn {
            background: #9c27b0;
            color: white;
        }
    </style>
</head>
<body>
    <h1>NavigationController Test</h1>
    
    <div id="app">
        <div class="test-container">
            <h2>Navigation Controller Demo</h2>
            
            <div class="debug-info">
                <strong>Current State:</strong><br>
                Window Width: {{ windowWidth }}px<br>
                Device Type: {{ deviceType }}<br>
                Navigation Type: {{ currentNavigationType }}<br>
                Is Transitioning: {{ isTransitioning }}
            </div>
            
            <div class="controls">
                <button class="desktop-btn" @click="simulateDesktop">Simulate Desktop (1200px)</button>
                <button class="mobile-btn" @click="simulateMobile">Simulate Mobile (768px)</button>
                <button @click="debugNavigation">Debug Navigation</button>
            </div>
            
            <div class="navigation-display" :class="navigationClass">
                <h3>{{ navigationTitle }}</h3>
                <navigation-controller
                    :current-route="currentRoute"
                    :initially-collapsed="false"
                    @navigate="handleNavigate"
                    @navigation-type-change="handleNavigationTypeChange"
                    @collapse-change="handleCollapseChange"
                    ref="navController"
                />
            </div>
            
            <div class="debug-info" v-if="lastEvent">
                <strong>Last Event:</strong><br>
                {{ JSON.stringify(lastEvent, null, 2) }}
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        // Mock NavigationController component for testing
        const NavigationController = {
            name: 'NavigationController',
            props: {
                currentRoute: String,
                initiallyCollapsed: Boolean,
                forceNavigationType: String
            },
            emits: ['navigate', 'navigation-type-change', 'collapse-change'],
            setup(props, { emit }) {
                const windowWidth = ref(window.innerWidth);
                const currentNavigationType = ref('desktop');
                const isTransitioning = ref(false);

                const deviceType = computed(() => {
                    if (props.forceNavigationType) {
                        return props.forceNavigationType;
                    }
                    return windowWidth.value >= 1024 ? 'desktop' : 'mobile';
                });

                const updateWindowSize = () => {
                    const oldType = currentNavigationType.value;
                    windowWidth.value = window.innerWidth;
                    const newType = deviceType.value;
                    
                    if (oldType !== newType) {
                        isTransitioning.value = true;
                        currentNavigationType.value = newType;
                        
                        emit('navigation-type-change', {
                            from: oldType,
                            to: newType,
                            breakpoint: windowWidth.value,
                            timestamp: Date.now()
                        });
                        
                        setTimeout(() => {
                            isTransitioning.value = false;
                        }, 300);
                    }
                };

                onMounted(() => {
                    currentNavigationType.value = deviceType.value;
                    window.addEventListener('resize', updateWindowSize);
                    
                    // Emit initial state
                    emit('navigation-type-change', {
                        from: null,
                        to: deviceType.value,
                        breakpoint: windowWidth.value,
                        timestamp: Date.now()
                    });
                });

                const debugNavigationController = () => {
                    console.group('üß≠ NavigationController Debug Info');
                    console.log('Current route:', props.currentRoute);
                    console.log('Window width:', windowWidth.value);
                    console.log('Device type:', deviceType.value);
                    console.log('Navigation type:', currentNavigationType.value);
                    console.log('Is transitioning:', isTransitioning.value);
                    console.groupEnd();
                };

                return {
                    windowWidth,
                    deviceType,
                    currentNavigationType,
                    isTransitioning,
                    debugNavigationController
                };
            },
            template: `
                <div class="navigation-controller">
                    <div v-if="deviceType === 'desktop'" class="desktop-navigation">
                        <h4>üñ•Ô∏è Desktop Navigation (Sidebar)</h4>
                        <p>Current Route: {{ currentRoute }}</p>
                        <p>Width: {{ windowWidth }}px</p>
                        <button @click="$emit('navigate', { route: 'dashboard', type: 'desktop' })">
                            Navigate to Dashboard
                        </button>
                        <button @click="$emit('collapse-change', true)">
                            Toggle Collapse
                        </button>
                    </div>
                    <div v-else class="mobile-navigation">
                        <h4>üì± Mobile Navigation</h4>
                        <p>Current Route: {{ currentRoute }}</p>
                        <p>Width: {{ windowWidth }}px</p>
                        <button @click="$emit('navigate', { route: 'dashboard', type: 'mobile' })">
                            Navigate to Dashboard
                        </button>
                    </div>
                    <div v-if="isTransitioning" style="color: orange; font-weight: bold;">
                        üîÑ Transitioning...
                    </div>
                </div>
            `
        };

        createApp({
            components: {
                NavigationController
            },
            setup() {
                const currentRoute = ref('dashboard');
                const windowWidth = ref(window.innerWidth);
                const deviceType = ref('desktop');
                const currentNavigationType = ref('desktop');
                const isTransitioning = ref(false);
                const lastEvent = ref(null);
                const navController = ref(null);

                const navigationClass = computed(() => ({
                    'desktop-nav': deviceType.value === 'desktop',
                    'mobile-nav': deviceType.value === 'mobile'
                }));

                const navigationTitle = computed(() => {
                    return deviceType.value === 'desktop' 
                        ? 'üñ•Ô∏è Desktop Navigation Active' 
                        : 'üì± Mobile Navigation Active';
                });

                const simulateDesktop = () => {
                    // Temporarily resize window to desktop size
                    Object.defineProperty(window, 'innerWidth', {
                        writable: true,
                        configurable: true,
                        value: 1200
                    });
                    window.dispatchEvent(new Event('resize'));
                    windowWidth.value = 1200;
                    deviceType.value = 'desktop';
                };

                const simulateMobile = () => {
                    // Temporarily resize window to mobile size
                    Object.defineProperty(window, 'innerWidth', {
                        writable: true,
                        configurable: true,
                        value: 768
                    });
                    window.dispatchEvent(new Event('resize'));
                    windowWidth.value = 768;
                    deviceType.value = 'mobile';
                };

                const handleNavigate = (event) => {
                    console.log('Navigation event:', event);
                    lastEvent.value = { type: 'navigate', data: event };
                };

                const handleNavigationTypeChange = (event) => {
                    console.log('Navigation type change:', event);
                    currentNavigationType.value = event.to;
                    deviceType.value = event.to;
                    windowWidth.value = event.breakpoint;
                    lastEvent.value = { type: 'navigation-type-change', data: event };
                };

                const handleCollapseChange = (collapsed) => {
                    console.log('Collapse change:', collapsed);
                    lastEvent.value = { type: 'collapse-change', data: collapsed };
                };

                const debugNavigation = () => {
                    if (navController.value) {
                        navController.value.debugNavigationController();
                    }
                };

                onMounted(() => {
                    windowWidth.value = window.innerWidth;
                    deviceType.value = window.innerWidth >= 1024 ? 'desktop' : 'mobile';
                    currentNavigationType.value = deviceType.value;
                });

                return {
                    currentRoute,
                    windowWidth,
                    deviceType,
                    currentNavigationType,
                    isTransitioning,
                    lastEvent,
                    navController,
                    navigationClass,
                    navigationTitle,
                    simulateDesktop,
                    simulateMobile,
                    handleNavigate,
                    handleNavigationTypeChange,
                    handleCollapseChange,
                    debugNavigation
                };
            }
        }).mount('#app');
    </script>
</body>
</html>